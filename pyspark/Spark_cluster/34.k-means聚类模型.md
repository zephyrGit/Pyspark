
1. 聚类分析又称群分析，他是研究（样品或指标）分类问题的一种统计分析方法，同时也是数据挖掘的一个重要算法。聚类（Cluster）分析是由若干模式（Pattern）组成的，通常，模式是一个度量（Measurement）的向量，或者是多维空间中的一个点。聚类分析以相似性为基础，在一个聚类中的模式之间比不同在同一聚类中的模式之间具有更多的相似性 

2. **k-means**  
    k-means聚类算法属于无监督学习，用于发现数据本身的分布特点，与监督学习不同，无监督学习不需要对数据进行标注可以节省大量时间，也让可以利用的数据规模变得无限量  
    k均值聚类算法需要预先设定聚类的个数，然后不断更新聚类中心，经过几轮的迭代，最后的目标是让所有的数据点到其属的聚类中心的距离平方和趋于稳定，计算过程如下：  
    - 算法的四个阶段
    1. 随机设置k个点作为聚类的中心
    2. 根据数据的特征向量，从K个聚类中寻找距离最近的一个，并把数据标注为从属于这个聚类中心
    3. 在所欲数据都被标注过数据中心后，根据这些新分配的类簇，重新对k个聚类中心做计算  
    4. 如果一轮下来， 所有数据点从属的聚类中心与上一次的分配的类簇没有变化，迭代停止，否则回到步骤2

3. 这里使用k-means算法对手写字体进行聚类处理，两个文件optdigits.tra和optdigits.tes，文件格式为csv格式，逗号分隔。
    有65个特征，前64个特征是64位的图片像素点亮度值，第’64‘列为对应的数字标签，前面64个值表示64个像素点的亮度，对应的数字是’0‘  
    使用spark.read.csv方法读取这两个文件，通过指定schema为“-c0 INT,_c1 INT...-c64 INT” 指定加载数据的schema信息和数据类型，然后使用VectorAssembler将前64列聚合在一起，形成特征向量  
    
~~~python

from pyspark.ml.clustering import KMeans
from pyspark.ml.feature import VectorAssembler
from pyspark.ml.evaluation import ClusteringEvaluator

schema = ''
for i in range(65):
    schema = schema + '_c' + str(i) + ' DOUBLE' + ','
schema = schema[:len(schema) - 1]

df_train = spark.read.csv('/data/mllib/optdigits/optdigits.tra', schema=schema)
df_test = spark.read.csv('/data/mllib/optdigits/optdigits.tes', schema=schema)
cols = []
for i in range(65):
    cols.append('_c' + str(i))

df_train.head = cols
df_test.head = cols

assembler = VectorAssembler(inputCols=cols[:-1], outputCol='features')
train_output = assembler.transform(df_train)
test_output = assembler.transform(df_test)
train_features = train_output.select('features').toDF('features')
test_features = test_output.select('features').toDF('features')
train_features.show(truncate=False)
test_features.show(truncate=False)
>>> 
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|features                                                                                                                                                                                                                                                                                        |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|(64,[1,2,3,4,5,9,10,11,12,13,17,18,19,21,22,25,26,27,29,30,33,34,35,37,38,41,42,44,45,46,50,51,52,53,58,59,60,61],[1.0,6.0,15.0,12.0,1.0,7.0,16.0,6.0,6.0,10.0,8.0,16.0,2.0,11.0,2.0,5.0,16.0,3.0,5.0,7.0,7.0,13.0,3.0,8.0,7.0,4.0,12.0,1.0,13.0,5.0,14.0,9.0,15.0,9.0,6.0,14.0,7.0,1.0])       |
|(64,[2,3,4,9,10,11,12,13,17,18,20,21,22,25,26,29,30,33,34,37,38,41,42,43,45,46,50,51,52,53,54,58,59,60,61],[10.0,16.0,6.0,7.0,16.0,8.0,16.0,5.0,11.0,16.0,6.0,14.0,3.0,12.0,12.0,11.0,11.0,12.0,12.0,8.0,12.0,7.0,15.0,1.0,13.0,11.0,16.0,8.0,10.0,15.0,3.0,10.0,16.0,15.0,3.0])                |
|(64,[2,3,4,5,9,10,11,12,13,14,20,21,26,27,28,29,30,33,34,35,36,37,38,41,42,43,44,50,51,52,58,59],[8.0,15.0,16.0,13.0,1.0,11.0,9.0,11.0,16.0,1.0,7.0,14.0,3.0,4.0,14.0,12.0,2.0,1.0,16.0,16.0,16.0,16.0,10.0,2.0,12.0,16.0,10.0,2.0,16.0,4.0,9.0,14.0])                                          |
|(64,[3,4,5,10,11,12,13,14,17,18,19,20,21,22,25,26,27,28,29,30,33,34,35,36,37,38,44,45,51,52,59,60,61],[3.0,11.0,16.0,5.0,16.0,11.0,13.0,7.0,3.0,15.0,8.0,1.0,15.0,6.0,11.0,16.0,16.0,16.0,16.0,10.0,1.0,4.0,4.0,13.0,10.0,2.0,15.0,4.0,3.0,16.0,1.0,15.0,2.0])                                  |
|(64,[2,3,4,10,11,17,18,19,25,26,27,28,29,33,34,35,36,37,38,42,43,45,46,50,51,52,53,54,58,59,60,61],[5.0,14.0,4.0,13.0,8.0,3.0,14.0,4.0,6.0,16.0,14.0,9.0,2.0,4.0,16.0,3.0,4.0,11.0,2.0,14.0,3.0,4.0,11.0,10.0,8.0,4.0,11.0,12.0,4.0,12.0,14.0,7.0])                                             |
|(64,[2,3,4,5,9,10,11,12,13,17,18,19,20,21,25,26,27,28,29,36,37,43,44,45,50,51,52,53,54,55,58,59,60,61,62,63],[11.0,16.0,10.0,1.0,4.0,16.0,10.0,15.0,8.0,4.0,16.0,3.0,11.0,13.0,1.0,14.0,6.0,9.0,14.0,12.0,10.0,6.0,16.0,6.0,5.0,15.0,15.0,8.0,8.0,3.0,10.0,16.0,16.0,16.0,16.0,6.0])            |
|(64,[2,3,4,5,6,10,11,12,13,14,18,19,20,21,22,25,26,27,28,29,30,33,34,37,38,44,45,51,52,53,58,59,60],[1.0,11.0,13.0,11.0,7.0,9.0,14.0,6.0,4.0,3.0,16.0,12.0,16.0,15.0,2.0,5.0,16.0,10.0,4.0,12.0,6.0,1.0,1.0,10.0,4.0,5.0,10.0,8.0,15.0,3.0,1.0,13.0,5.0])                                       |
|(64,[2,3,4,5,6,9,10,11,12,13,14,17,18,19,20,25,26,27,28,29,36,37,44,45,50,51,52,53,58,59,60],[8.0,10.0,8.0,7.0,2.0,1.0,15.0,14.0,12.0,12.0,4.0,7.0,15.0,12.0,5.0,5.0,14.0,12.0,15.0,7.0,2.0,13.0,4.0,12.0,6.0,7.0,14.0,5.0,4.0,13.0,8.0])                                                       |
|(64,[2,3,4,5,6,10,11,12,13,14,17,18,19,20,21,22,25,26,27,29,30,33,34,37,38,41,42,44,45,46,49,50,51,52,53,58,59,60],[15.0,2.0,14.0,13.0,2.0,16.0,15.0,12.0,13.0,8.0,2.0,16.0,12.0,1.0,6.0,10.0,7.0,15.0,3.0,5.0,8.0,5.0,12.0,8.0,8.0,5.0,12.0,7.0,15.0,5.0,5.0,16.0,13.0,16.0,6.0,10.0,12.0,5.0])|
|(64,[2,3,4,5,9,10,11,12,13,17,18,19,20,21,25,26,27,28,33,34,35,36,37,38,42,43,45,46,50,51,52,53,54,58,59,60,61],[3.0,13.0,13.0,2.0,6.0,16.0,12.0,10.0,8.0,9.0,15.0,12.0,16.0,6.0,10.0,16.0,16.0,13.0,1.0,12.0,16.0,12.0,14.0,4.0,11.0,8.0,3.0,12.0,13.0,11.0,8.0,13.0,12.0,3.0,15.0,11.0,6.0])  |
|(64,[2,3,4,5,6,7,10,11,12,13,14,15,20,21,22,25,26,27,28,29,30,33,34,35,36,43,44,50,51,58,59],[6.0,14.0,14.0,16.0,16.0,8.0,7.0,11.0,8.0,10.0,15.0,3.0,4.0,15.0,10.0,1.0,15.0,16.0,16.0,16.0,14.0,3.0,11.0,13.0,13.0,15.0,5.0,7.0,13.0,10.0,12.0])                                                |
|(64,[3,4,5,6,11,12,13,14,19,20,21,25,26,27,28,29,33,34,35,36,37,41,42,43,44,45,51,52,53,59,60,61,62],[3.0,16.0,11.0,1.0,8.0,16.0,16.0,1.0,9.0,16.0,14.0,1.0,7.0,16.0,16.0,11.0,9.0,16.0,16.0,16.0,8.0,1.0,8.0,6.0,16.0,7.0,5.0,16.0,9.0,2.0,14.0,14.0,1.0])                                     |
|(64,[3,4,5,6,7,10,11,12,13,14,15,17,18,19,20,21,22,25,26,27,28,29,30,33,34,35,36,37,44,45,51,52,53,59,60,61],[4.0,13.0,16.0,16.0,3.0,8.0,16.0,9.0,12.0,16.0,4.0,7.0,16.0,3.0,3.0,15.0,13.0,9.0,15.0,14.0,16.0,16.0,6.0,1.0,8.0,7.0,12.0,15.0,13.0,10.0,3.0,15.0,6.0,5.0,15.0,4.0])              |
|(64,[2,3,4,5,10,11,12,13,14,17,18,19,20,25,26,27,28,29,33,34,36,37,44,45,50,51,52,53,58,59,60],[7.0,12.0,6.0,2.0,16.0,16.0,13.0,14.0,1.0,9.0,16.0,11.0,3.0,8.0,16.0,16.0,16.0,4.0,1.0,2.0,6.0,12.0,7.0,12.0,6.0,9.0,16.0,6.0,5.0,16.0,9.0])                                                     |
|(64,[2,3,4,5,9,10,11,12,13,17,18,20,21,26,27,28,29,33,34,35,36,37,42,43,44,45,46,50,51,52,53,54,58,59,60,61,62],[7.0,11.0,11.0,6.0,9.0,16.0,12.0,10.0,14.0,5.0,2.0,4.0,14.0,1.0,5.0,14.0,6.0,1.0,15.0,16.0,16.0,10.0,7.0,4.0,4.0,15.0,6.0,5.0,4.0,8.0,13.0,12.0,14.0,16.0,12.0,10.0,1.0])       |
|(64,[1,2,3,4,9,10,11,12,13,17,18,19,20,21,22,25,26,29,30,33,34,37,38,41,42,44,45,46,50,51,52,53,58,59,60],[1.0,10.0,15.0,8.0,6.0,16.0,7.0,11.0,8.0,7.0,16.0,3.0,1.0,13.0,1.0,7.0,13.0,10.0,6.0,8.0,12.0,14.0,4.0,3.0,16.0,6.0,15.0,2.0,15.0,9.0,16.0,4.0,9.0,15.0,8.0])                         |
|(64,[3,4,5,10,11,12,13,14,18,19,20,21,25,26,27,28,29,30,34,35,36,37,38,43,44,45,51,52,59,60],[1.0,11.0,7.0,2.0,13.0,10.0,16.0,4.0,13.0,4.0,1.0,16.0,6.0,14.0,8.0,12.0,16.0,7.0,8.0,8.0,15.0,10.0,2.0,1.0,12.0,1.0,4.0,16.0,3.0,15.0])                                                           |
|(64,[2,3,4,5,6,10,11,12,13,14,19,20,21,22,26,27,28,29,30,35,36,37,43,44,50,51,52,58,59],[5.0,12.0,16.0,16.0,3.0,11.0,11.0,4.0,16.0,9.0,4.0,8.0,16.0,5.0,4.0,16.0,16.0,16.0,14.0,11.0,14.0,1.0,13.0,10.0,3.0,16.0,1.0,8.0,12.0])                                                                 |
|(64,[2,3,4,5,6,9,10,11,12,13,14,17,18,19,20,21,25,26,27,28,29,34,35,37,38,42,43,45,46,50,51,52,53,54,58,59,60,61],[1.0,8.0,13.0,13.0,2.0,4.0,16.0,8.0,1.0,12.0,4.0,7.0,13.0,3.0,10.0,13.0,3.0,15.0,15.0,14.0,15.0,13.0,10.0,10.0,6.0,11.0,5.0,9.0,8.0,7.0,11.0,4.0,14.0,2.0,1.0,13.0,12.0,4.0]) |
|(64,[3,4,5,6,10,11,12,13,14,17,18,19,20,21,22,25,26,27,28,29,30,33,34,35,36,37,38,44,45,52,53,60,61],[2.0,13.0,12.0,4.0,3.0,15.0,15.0,13.0,12.0,2.0,15.0,14.0,1.0,12.0,8.0,8.0,16.0,14.0,16.0,16.0,11.0,3.0,16.0,16.0,16.0,16.0,10.0,8.0,13.0,13.0,7.0,15.0,3.0])                               |
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
only showing top 20 rows

+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|features                                                                                                                                                                                                                                                                                           |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|(64,[2,3,4,5,10,11,12,13,14,17,18,19,21,22,25,26,29,30,33,34,37,38,41,42,44,45,46,49,50,51,52,53,58,59,60],[5.0,13.0,9.0,1.0,13.0,15.0,10.0,15.0,5.0,3.0,15.0,2.0,11.0,8.0,4.0,12.0,8.0,8.0,5.0,8.0,9.0,8.0,4.0,11.0,1.0,12.0,7.0,2.0,14.0,5.0,10.0,12.0,6.0,13.0,10.0])                           |
|(64,[3,4,5,11,12,13,18,19,20,21,25,26,27,28,29,34,35,36,37,42,43,44,45,50,51,52,53,59,60,61],[12.0,13.0,5.0,11.0,16.0,9.0,3.0,15.0,16.0,6.0,7.0,15.0,16.0,16.0,2.0,1.0,16.0,16.0,3.0,1.0,16.0,16.0,6.0,1.0,16.0,16.0,6.0,11.0,16.0,10.0])                                                          |
|(64,[3,4,5,10,11,12,13,18,19,20,21,26,27,28,29,33,34,35,36,37,41,42,43,44,49,50,51,52,53,54,59,60,61,62],[4.0,15.0,12.0,3.0,16.0,15.0,14.0,8.0,13.0,8.0,16.0,1.0,6.0,15.0,11.0,1.0,8.0,13.0,15.0,1.0,9.0,16.0,16.0,5.0,3.0,13.0,16.0,16.0,11.0,5.0,3.0,11.0,16.0,9.0])                             |
|(64,[2,3,4,5,9,10,11,12,13,17,18,19,20,26,27,28,29,35,36,37,38,44,45,46,50,51,52,53,54,58,59,60,61],[7.0,15.0,13.0,1.0,8.0,13.0,6.0,15.0,4.0,2.0,1.0,13.0,13.0,2.0,15.0,11.0,1.0,1.0,12.0,12.0,1.0,1.0,10.0,8.0,8.0,4.0,5.0,14.0,9.0,7.0,13.0,13.0,9.0])                                           |
|(64,[3,4,11,12,18,19,20,21,22,26,27,29,30,33,34,35,37,38,41,42,43,44,45,46,51,52,53,59,60,61],[1.0,11.0,7.0,8.0,1.0,13.0,6.0,2.0,2.0,7.0,15.0,9.0,8.0,5.0,16.0,10.0,16.0,6.0,4.0,15.0,16.0,13.0,16.0,1.0,3.0,15.0,10.0,2.0,16.0,4.0])                                                              |
|(64,[2,3,10,11,12,13,18,19,20,21,22,26,27,28,29,35,36,37,38,44,45,46,50,51,52,53,54,58,59,60,61],[12.0,10.0,14.0,16.0,16.0,14.0,13.0,16.0,15.0,10.0,1.0,11.0,16.0,16.0,7.0,4.0,7.0,16.0,7.0,4.0,16.0,9.0,5.0,4.0,12.0,16.0,4.0,9.0,16.0,16.0,10.0])                                                |
|(64,[3,4,10,11,12,18,19,20,26,27,34,35,36,37,42,43,44,45,46,50,51,52,53,54,58,59,60,61,62],[12.0,13.0,5.0,16.0,8.0,13.0,16.0,3.0,14.0,13.0,15.0,12.0,7.0,2.0,13.0,16.0,13.0,16.0,3.0,7.0,16.0,11.0,15.0,8.0,1.0,9.0,15.0,11.0,3.0])                                                                |
|(64,[2,3,4,5,6,7,10,11,12,13,14,20,21,22,25,26,27,28,29,30,33,34,35,36,37,43,44,50,51,52,58,59],[7.0,8.0,13.0,16.0,15.0,1.0,7.0,7.0,4.0,11.0,12.0,8.0,13.0,1.0,4.0,8.0,8.0,15.0,15.0,6.0,2.0,11.0,15.0,15.0,4.0,16.0,5.0,9.0,15.0,1.0,13.0,5.0])                                                   |
|(64,[2,3,4,5,10,11,12,13,18,19,21,22,26,27,28,29,30,34,35,36,37,41,42,43,44,45,46,49,50,51,52,53,54,58,59,60,61,62],[9.0,14.0,8.0,1.0,12.0,14.0,14.0,12.0,9.0,10.0,15.0,4.0,3.0,16.0,12.0,14.0,2.0,4.0,16.0,16.0,2.0,3.0,16.0,8.0,10.0,13.0,2.0,1.0,15.0,1.0,3.0,16.0,8.0,11.0,16.0,15.0,11.0,1.0])|
|(64,[2,3,9,10,11,12,13,17,18,19,20,21,25,26,27,28,29,34,35,36,37,38,43,45,46,52,53,54,58,59,60,61],[11.0,12.0,2.0,16.0,16.0,16.0,13.0,3.0,16.0,12.0,10.0,14.0,1.0,16.0,1.0,12.0,15.0,13.0,16.0,9.0,15.0,2.0,3.0,9.0,11.0,9.0,15.0,4.0,9.0,12.0,13.0,3.0])                                          |
|(64,[2,3,4,5,10,11,12,13,14,17,18,19,21,22,25,26,27,29,30,33,34,35,37,38,41,42,43,44,45,46,50,51,52,53,58,59,60,61],[1.0,9.0,15.0,11.0,11.0,16.0,8.0,14.0,6.0,2.0,16.0,10.0,9.0,9.0,1.0,16.0,4.0,8.0,8.0,4.0,16.0,4.0,8.0,8.0,1.0,16.0,5.0,1.0,11.0,3.0,12.0,12.0,10.0,10.0,1.0,10.0,13.0,3.0])    |
|(64,[4,5,6,11,12,13,14,19,20,21,25,26,27,28,29,33,34,35,36,37,43,44,45,51,52,53,59,60,61,62],[14.0,13.0,1.0,5.0,16.0,16.0,2.0,14.0,16.0,12.0,1.0,10.0,16.0,16.0,12.0,3.0,12.0,14.0,16.0,9.0,5.0,16.0,15.0,4.0,16.0,14.0,1.0,13.0,16.0,1.0])                                                        |
|(64,[2,3,4,10,11,12,18,19,20,25,26,28,34,36,37,43,44,50,51,52,53,54,55,58,59,60,61,62,63],[5.0,12.0,1.0,15.0,14.0,7.0,13.0,1.0,12.0,2.0,10.0,14.0,2.0,16.0,1.0,6.0,15.0,9.0,16.0,15.0,9.0,8.0,2.0,3.0,11.0,8.0,13.0,12.0,4.0])                                                                     |
|(64,[1,2,3,4,5,6,9,10,11,12,13,14,19,20,21,22,27,28,29,35,36,37,44,45,46,49,50,51,52,53,54,57,58,59,60,61],[2.0,9.0,15.0,14.0,9.0,3.0,4.0,13.0,8.0,9.0,16.0,8.0,6.0,14.0,15.0,3.0,11.0,14.0,2.0,2.0,15.0,11.0,2.0,15.0,4.0,1.0,5.0,6.0,13.0,16.0,6.0,2.0,12.0,12.0,13.0,11.0])                     |
|(64,[3,4,5,10,11,12,13,14,18,19,20,21,22,25,26,27,28,29,30,33,34,35,36,37,38,41,42,43,44,45,51,52,53,59,60,61],[8.0,15.0,1.0,1.0,14.0,13.0,1.0,1.0,10.0,15.0,3.0,15.0,11.0,7.0,16.0,7.0,1.0,16.0,8.0,9.0,16.0,13.0,14.0,16.0,5.0,1.0,10.0,15.0,16.0,14.0,1.0,16.0,10.0,10.0,15.0,4.0])             |
|(64,[1,2,3,4,5,6,9,10,11,12,13,17,18,19,20,25,26,27,28,33,34,35,36,43,44,45,49,50,51,52,57,58,59,60],[5.0,12.0,13.0,16.0,16.0,2.0,11.0,16.0,15.0,8.0,4.0,8.0,14.0,11.0,1.0,8.0,16.0,16.0,14.0,1.0,6.0,6.0,16.0,5.0,16.0,3.0,1.0,5.0,15.0,13.0,4.0,15.0,16.0,2.0])                                  |
|(64,[3,4,5,11,12,18,19,20,26,27,28,34,35,36,37,38,42,43,44,45,46,50,51,52,53,54,55,59,60,61,62],[8.0,15.0,1.0,12.0,14.0,3.0,16.0,7.0,6.0,16.0,2.0,7.0,16.0,16.0,13.0,5.0,15.0,16.0,9.0,9.0,14.0,3.0,14.0,9.0,2.0,16.0,2.0,7.0,15.0,16.0,11.0])                                                     |
|(64,[2,3,4,5,9,10,11,12,13,17,18,20,21,26,27,28,29,30,34,35,36,37,38,41,42,43,44,45,46,51,52,59,60],[1.0,8.0,15.0,10.0,3.0,13.0,15.0,14.0,14.0,5.0,10.0,10.0,12.0,3.0,5.0,15.0,10.0,2.0,16.0,16.0,16.0,16.0,12.0,1.0,8.0,12.0,14.0,8.0,3.0,10.0,13.0,11.0,9.0])                                    |
|(64,[2,3,4,5,10,11,12,13,14,18,19,20,21,26,27,28,29,34,35,36,42,43,44,49,50,51,52,58,59,60],[10.0,7.0,13.0,9.0,9.0,10.0,12.0,15.0,2.0,4.0,11.0,10.0,11.0,1.0,16.0,10.0,1.0,12.0,13.0,4.0,12.0,1.0,12.0,1.0,10.0,2.0,14.0,11.0,14.0,5.0])                                                           |
|(64,[2,3,4,10,11,12,18,19,20,21,26,27,28,29,37,38,45,46,50,51,52,53,54,55,58,59,60,61,62,63],[6.0,14.0,4.0,11.0,16.0,10.0,8.0,14.0,16.0,2.0,1.0,12.0,12.0,11.0,11.0,3.0,5.0,11.0,1.0,4.0,4.0,7.0,16.0,2.0,7.0,16.0,16.0,13.0,11.0,1.0])                                                            |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
only showing top 20 rows

kmeans = KMeans().setK(10).setSeed(1)
model = kmeans.fit(train_features)

predictions = model.transform(test_features)
evaluator = ClusteringEvaluator()

silhouette = evaluator.evaluate(predictions)
print('Silhouette with squared euclidean distance = ' + str(silhouette))

centers = model.clusterCenters()
print('Cluster Centers:')
for center in centers:
    print(center)
>>> 
Silhouette with squared euclidean distance = 0.2966961639805435

Cluster Centers:
[  0.00000000e+00   1.80412371e-02   2.30412371e+00   1.08994845e+01
   7.91237113e+00   1.08762887e+00   0.00000000e+00   0.00000000e+00
   0.00000000e+00   2.19072165e-01   8.23453608e+00   1.36262887e+01
   5.65463918e+00   8.11855670e-01   0.00000000e+00   0.00000000e+00
   0.00000000e+00   1.03865979e+00   1.26701031e+01   8.79896907e+00
   6.52061856e-01   4.38144330e-02   1.28865979e-02   0.00000000e+00
   0.00000000e+00   2.22422680e+00   1.38376289e+01   7.02319588e+00
   2.73969072e+00   1.12628866e+00   1.00515464e-01   0.00000000e+00
   0.00000000e+00   3.30927835e+00   1.45463918e+01   1.18891753e+01
   1.15128866e+01   9.26288660e+00   2.03092784e+00   0.00000000e+00
   0.00000000e+00   2.18298969e+00   1.47036082e+01   1.14613402e+01
   7.62113402e+00   1.11262887e+01   8.99484536e+00   1.72680412e-01
   0.00000000e+00   5.54123711e-01   1.07371134e+01   1.27164948e+01
   6.31185567e+00   1.10747423e+01   1.13195876e+01   8.01546392e-01
   0.00000000e+00   4.12371134e-02   2.27577320e+00   1.06443299e+01
   1.45515464e+01   1.28170103e+01   5.54896907e+00   2.86082474e-01]
[  0.00000000e+00   1.99535963e-01   6.66589327e+00   1.34872390e+01
   1.20835267e+01   4.73317865e+00   5.80046404e-01   1.16009281e-02
   0.00000000e+00   2.72389791e+00   1.39930394e+01   9.85614849e+00
   1.02923434e+01   9.60788863e+00   1.18329466e+00   0.00000000e+00
   0.00000000e+00   4.56612529e+00   1.29350348e+01   5.32946636e+00
   7.96983759e+00   1.12830626e+01   1.74245940e+00   0.00000000e+00
   0.00000000e+00   2.19953596e+00   1.07587007e+01   1.16705336e+01
   1.28422274e+01   1.32018561e+01   2.72853828e+00   0.00000000e+00
   0.00000000e+00   2.52900232e-01   3.31554524e+00   5.67053364e+00
   6.21809745e+00   1.27215777e+01   5.40139211e+00   0.00000000e+00
   0.00000000e+00   2.48259861e-01   2.39211137e+00   1.15545244e+00
   8.97911833e-01   1.06589327e+01   7.93735499e+00   1.39211137e-02
   0.00000000e+00   7.65661253e-01   7.96055684e+00   6.13921114e+00
   5.82134571e+00   1.28770302e+01   6.99071926e+00   1.09048724e-01
   0.00000000e+00   1.53132251e-01   6.72389791e+00   1.38932715e+01
   1.40951276e+01   9.92343387e+00   2.40835267e+00   1.16009281e-01]
[  0.00000000e+00   8.44086022e-01   9.00806452e+00   1.41182796e+01
   1.31397849e+01   5.42204301e+00   5.08064516e-01   2.15053763e-02
   0.00000000e+00   4.22580645e+00   1.28736559e+01   9.04301075e+00
   1.17876344e+01   1.06478495e+01   1.41935484e+00   1.61290323e-02
   0.00000000e+00   1.53494624e+00   3.22043011e+00   3.53763441e+00
   1.17634409e+01   8.77419355e+00   6.39784946e-01   0.00000000e+00
   0.00000000e+00   1.34408602e-01   2.37903226e+00   1.07956989e+01
   1.41612903e+01   5.43817204e+00   1.66666667e-01   0.00000000e+00
   0.00000000e+00   7.25806452e-02   1.93279570e+00   7.85215054e+00
   1.25967742e+01   1.16397849e+01   2.14247312e+00   0.00000000e+00
   0.00000000e+00   1.15591398e-01   9.73118280e-01   7.66129032e-01
   3.76881720e+00   1.29946237e+01   6.29032258e+00   8.06451613e-03
   0.00000000e+00   1.02956989e+00   7.59946237e+00   6.13709677e+00
   7.90591398e+00   1.36666667e+01   5.87096774e+00   3.49462366e-02
   0.00000000e+00   7.28494624e-01   1.00026882e+01   1.44731183e+01
   1.30295699e+01   7.80376344e+00   1.43548387e+00   4.03225806e-02]
[  0.00000000e+00   5.53956835e-01   8.29136691e+00   1.31294964e+01
   1.38093525e+01   1.12338129e+01   2.97122302e+00   2.51798561e-02
   1.07913669e-02   3.57194245e+00   1.44784173e+01   1.31294964e+01
   9.54676259e+00   8.42086331e+00   2.37410072e+00   1.79856115e-02
   1.79856115e-02   5.12949640e+00   1.40899281e+01   5.65467626e+00
   1.04316547e+00   6.33093525e-01   2.94964029e-01   3.59712230e-03
   0.00000000e+00   5.02877698e+00   1.40791367e+01   1.16834532e+01
   7.26618705e+00   2.08633094e+00   2.98561151e-01   0.00000000e+00
   0.00000000e+00   1.52877698e+00   7.80575540e+00   1.00467626e+01
   1.12050360e+01   6.14028777e+00   4.38848921e-01   0.00000000e+00
   0.00000000e+00   1.15107914e-01   1.15827338e+00   3.93525180e+00
   9.28417266e+00   8.50359712e+00   7.91366906e-01   0.00000000e+00
   0.00000000e+00   6.18705036e-01   6.13669065e+00   8.88489209e+00
   1.22302158e+01   7.47482014e+00   5.17985612e-01   0.00000000e+00
   0.00000000e+00   4.28057554e-01   9.33093525e+00   1.44280576e+01
   9.62949640e+00   2.23741007e+00   8.63309353e-02   1.07913669e-02]
[  0.00000000e+00   3.41296928e-02   1.32423208e+00   6.10580205e+00
   1.21979522e+01   1.15904437e+01   3.76791809e+00   2.11604096e-01
   0.00000000e+00   6.79180887e-01   6.92491468e+00   1.10546075e+01
   1.14778157e+01   1.27064846e+01   5.87030717e+00   3.24232082e-01
   0.00000000e+00   2.44368601e+00   1.10102389e+01   9.96587031e+00
   1.03139932e+01   1.23822526e+01   4.44027304e+00   1.22866894e-01
   0.00000000e+00   3.41638225e+00   1.15870307e+01   1.18805461e+01
   1.33993174e+01   1.35017065e+01   3.69283276e+00   3.41296928e-03
   0.00000000e+00   1.31740614e+00   4.87030717e+00   5.32081911e+00
   1.02696246e+01   1.31501706e+01   2.22866894e+00   0.00000000e+00
   0.00000000e+00   8.19112628e-02   3.41296928e-01   1.69624573e+00
   1.10887372e+01   1.14982935e+01   1.04436860e+00   0.00000000e+00
   0.00000000e+00   6.82593857e-03   6.07508532e-01   5.04095563e+00
   1.35972696e+01   8.72013652e+00   7.91808874e-01   0.00000000e+00
   0.00000000e+00   1.02389078e-02   1.35494881e+00   6.88054608e+00
   1.01467577e+01   5.81228669e+00   9.72696246e-01   0.00000000e+00]
[  0.00000000e+00   9.50819672e-01   1.05655738e+01   1.38606557e+01
   6.72131148e+00   8.03278689e-01   1.09289617e-02   0.00000000e+00
   0.00000000e+00   4.95901639e+00   1.43961749e+01   1.28360656e+01
   1.19371585e+01   3.23224044e+00   4.91803279e-02   0.00000000e+00
   0.00000000e+00   4.58469945e+00   8.36885246e+00   4.91803279e+00
   1.14535519e+01   4.49180328e+00   1.01092896e-01   0.00000000e+00
   0.00000000e+00   1.16666667e+00   2.71857923e+00   5.19945355e+00
   1.15874317e+01   3.73770492e+00   3.55191257e-02   0.00000000e+00
   0.00000000e+00   9.28961749e-02   1.17759563e+00   8.34153005e+00
   1.05519126e+01   1.90437158e+00   0.00000000e+00   0.00000000e+00
   0.00000000e+00   1.99453552e-01   4.22950820e+00   1.13551913e+01
   7.58743169e+00   1.41530055e+00   3.19672131e-01   0.00000000e+00
   0.00000000e+00   1.39071038e+00   1.16857923e+01   1.47240437e+01
   1.23333333e+01   1.09918033e+01   7.31420765e+00   5.35519126e-01
   0.00000000e+00   9.45355191e-01   1.06393443e+01   1.41448087e+01
   1.33142077e+01   1.24808743e+01   9.47267760e+00   1.60382514e+00]
[  0.00000000e+00   3.65688488e-01   7.00677201e+00   1.33702032e+01
   1.36613995e+01   1.15553047e+01   5.95485327e+00   9.63882619e-01
   0.00000000e+00   1.09706546e+00   9.40180587e+00   1.01467269e+01
   9.83295711e+00   1.30248307e+01   7.78781038e+00   8.35214447e-01
   0.00000000e+00   9.18735892e-01   2.93227991e+00   1.26410835e+00
   6.31376975e+00   1.27629797e+01   4.60948081e+00   1.12866817e-01
   0.00000000e+00   9.36794582e-01   4.33634312e+00   7.17607223e+00
   1.27584650e+01   1.24920993e+01   4.00000000e+00   4.51467269e-03
   0.00000000e+00   1.48306998e+00   8.21444695e+00   1.35169300e+01
   1.52031603e+01   1.17065463e+01   4.26410835e+00   0.00000000e+00
   0.00000000e+00   6.88487585e-01   3.80135440e+00   1.21828442e+01
   1.06094808e+01   3.30022573e+00   6.02708804e-01   0.00000000e+00
   0.00000000e+00   1.73814898e-01   4.97516930e+00   1.35169300e+01
   5.03160271e+00   3.20541761e-01   1.80586907e-02   0.00000000e+00
   0.00000000e+00   3.81489842e-01   8.30248307e+00   1.15011287e+01
   1.75846501e+00   2.64108352e-01   2.93453725e-02   0.00000000e+00]
[  0.00000000e+00   2.91545190e-03   1.89504373e-01   5.38775510e+00
   1.21341108e+01   3.09037901e+00   3.09037901e-01   1.02040816e-01
   0.00000000e+00   1.45772595e-02   1.78717201e+00   1.16064140e+01
   1.02944606e+01   2.50728863e+00   1.60641399e+00   3.06122449e-01
   0.00000000e+00   3.46938776e-01   7.11370262e+00   1.25976676e+01
   4.67638484e+00   5.46064140e+00   4.28862974e+00   2.94460641e-01
   0.00000000e+00   3.16909621e+00   1.29533528e+01   8.73760933e+00
   4.76093294e+00   1.13265306e+01   5.87463557e+00   2.62390671e-02
   1.45772595e-02   7.24781341e+00   1.50204082e+01   1.02419825e+01
   1.16705539e+01   1.46501458e+01   4.90087464e+00   0.00000000e+00
   3.06122449e-01   6.61807580e+00   1.10349854e+01   1.14023324e+01
   1.49883382e+01   1.24489796e+01   1.86880466e+00   0.00000000e+00
   1.83673469e-01   2.08746356e+00   3.38192420e+00   6.91836735e+00
   1.45918367e+01   6.62973761e+00   3.81924198e-01   0.00000000e+00
   0.00000000e+00   4.37317784e-02   2.71137026e-01   6.27988338e+00
   1.25276968e+01   3.21574344e+00   7.58017493e-02   0.00000000e+00]
[  0.           0.02956989   4.60483871  13.2311828   10.94892473
   2.61827957   0.05913978   0.           0.           1.18010753
  13.04301075  13.06989247  12.23387097  10.73924731   0.7311828    0.           0.
   3.89784946  14.40860215   4.58064516   2.94623656  12.72580645
   3.31451613   0.           0.           5.24462366  12.74462366
   1.56451613   0.26612903   9.19086022   6.63172043   0.           0.
   5.45430108  11.89516129   0.86290323   0.11021505   8.66397849
   7.36827957   0.           0.           3.34946237  13.52150538
   1.68010753   1.41397849  11.37365591   6.44623656   0.           0.
   0.77150538  13.20967742  10.52419355  10.61290323  13.48387097
   2.67473118   0.           0.           0.0188172    4.61827957
  13.60752688  13.32258065   5.56451613   0.19623656   0.        ]
[  0.00000000e+00   1.09869646e-01   4.46368715e+00   1.23556797e+01
   1.20167598e+01   4.84543762e+00   3.07262570e-01   0.00000000e+00
   9.31098696e-03   1.35381750e+00   1.01843575e+01   1.29683426e+01
   1.26256983e+01   1.01024209e+01   1.30726257e+00   0.00000000e+00
   2.60707635e-02   2.20856611e+00   1.04897579e+01   1.08826816e+01
   1.19348231e+01   9.15456238e+00   1.23277467e+00   0.00000000e+00
   7.44878957e-03   1.46927374e+00   9.35009311e+00   1.44450652e+01
   1.40484171e+01   5.93296089e+00   4.43202980e-01   0.00000000e+00
   0.00000000e+00   6.94599628e-01   7.90689013e+00   1.51061453e+01
   1.29627561e+01   3.86219739e+00   2.53258845e-01   0.00000000e+00
   0.00000000e+00   7.95158287e-01   9.52886406e+00   1.22290503e+01
   1.22234637e+01   5.96834264e+00   4.09683426e-01   0.00000000e+00
   9.31098696e-03   8.26815642e-01   9.72067039e+00   1.17653631e+01
   1.18286778e+01   8.32588454e+00   1.00000000e+00   0.00000000e+00
   1.86219739e-03   1.30353818e-01   4.67597765e+00   1.23668529e+01
   1.24636872e+01   6.10800745e+00   8.13780261e-01   1.30353818e-02]
~~~~

**度量聚类算法的性能： 轮廓系数**  
轮廓系数同时兼顾了聚类的凝聚度Cohesion和分散度Separation，用于评估分类的效果，并且取值范围为[-1,1]轮廓系数越大，表示聚类效果越好  
具体计算步骤如下：  
1. 对于已聚类数据中的第i个样本xi，计算xi与同一个类簇内所有其它样本聚类的平均值，记为ai，用于量化簇内的凝聚度  
2. 选取xi外的一个簇b，计算xi与簇b中所有样本的平均距离，遍历所有其它簇，找到最近的这个平均距离，记为bi，用于量化簇之间的分离度Separation  
3. 对于样本xi， 轮廓系数为： sci = (bi-ai) / max(bi,ai)  
4. 最后对所有样本X求出平均值即为当前聚类结果的整体轮廓系数  
由轮廓系数的计算公式，如果sci小于0，说明xi与其簇内元素的平均距离大于最近的其它簇，表示聚类效果不好。如果ai趋于0或者bi足够大，那sci趋于1说明聚类效果越好  

上面的运行结果轮廓系数为0.29效果并不太好，k-means算法中最重要的其实就是确定k的取值，通常这个值需要使用网格搜索来确定最佳的k值。下面k设置为5的效果  

~~~python

kmeans = KMeans().setK(5).setSeed(1)
model = kmeans.fit(train_features)

# Make predictions 
predictions = model.transform(test_features)

# Evaluate clustering by computing Silhouette score
evaluator = ClusteringEvaluator()

silhouette = evaluator.evaluate(predictions)
print('Silhouette with squared euclidean distance =' + str(silhouette))
>>> 
Silhouette with squared euclidean distance =0.19916969234496196
~~~
结果为0.199，可以试着把聚类中心调为20个  

~~~python

kmeans = KMeans().setK(20).setSeed(1)
model = kmeans.fit(train_features)
predictions = model.transform(test_features)
evaluator = ClusteringEvaluator()
silhouette = evaluator.evaluate(predictions)
print('Silhouette with squared euclidean distance=' + str(silhouette))
>>> 
Silhouette with squared euclidean distance=0.255700155305325
~~~

可以使用“肘部观察法”粗略的估计相对合理的簇类个数。因为k-means模型最终期望所有数据点到其所属的簇类距离的平方和趋于稳定，所有我们可以通过观察这个数值随着k的走势来找出最佳的簇类数量。理想情况下这个折现在不断下降并且趋于平缓的过程，在这个过程中会出现斜率的拐点。从这个拐点开始，簇类中心的增加不会过于破坏数据聚类的结构。这个拐点就是最佳的k值 
上面为例，距离在k=3时出现了明显的拐点，继续增加k值对分类就没有明显的效果了 
