
1. 二分k均值（bisecting k-means）是一种层次聚类方法，算法的主要思想是：首先将所有点作为一个簇，然后将该簇一分为二。之后选择能将最大程度降低聚类代价函数（也就是误差平方和）的簇划分为两个簇。以此进行下去，直到簇的数目等于用户给定的数目k为止。  
    以上隐含着一个原则是：因为聚类的误差平方和能够衡量聚类性能，该值越小表示数据点越接近于它们的质心，聚类效果就越好。所以就需要对误差平方和最大的簇及逆行再一次的划分，因为误差平方和越大，表示该簇聚类越不好，越有可能就是多个簇当成一个簇了，所以首先需要对这个簇进行划分  
    
使用二分k均值算法，对手写字体进行聚类处理  

~~~python

from pyspark.ml.clustering import BisectingKMeans
from pyspark.ml.evaluation import ClusteringEvaluator
from pyspark.ml.feature import VectorAssembler

schema = ''
for i in range(65):
    schema = schema + '_c' + str(i) + ' DOUBLE' + ','

schema = schema[:len(schema) - 1]

df_train = spark.read.csv('/data/mllib/optdigits/optdigits.tra', schema=schema)
df_test = spark.read.csv('/data/mllib/optdigits/optdigits.tes', schema=schema)

cols = []
for i in range(65):
    cols.append('_c' + str(i))
    
''' 
# 可以直接读取节点上保存的数据
train_output = spark.sql('select * from worker.optdigits_tra')
test_output = spark.sql('select * from worker.optdigits_tes')
'''
    
df_train.head = cols
df_test.head = cols
assembler = VectorAssembler(inputCols=cols[:-1], outputCol='features')
train_output = assembler.transform(df_train)
test_output = assembler.transform(df_test)
train_features = train_output.select('features').toDF('features')
test_features = test_output.select('features').toDF('features')
bkm = BisectingKMeans().setK(10).setSeed(1)
model = bkm.fit(train_features)

predictions = model.transform(test_features)
evaluator = ClusteringEvaluator()
silhoutette = evaluator.evaluate(predictions)
print('Silhouette with squared euclidean distance = ' + str(silhoutette))
print('Cluster Centers:')
centers = model.clusterCenters()
for center in centers:
    print(center)
>>> 
Silhouette with squared euclidean distance = 0.21143190158556502
Cluster Centers:
[  0.           0.08695652   2.66819222  11.05720824   8.25629291
   1.63615561   0.15789474   0.           0.           0.48283753
   8.59038902  13.67505721   6.15102975   1.22654462   0.11212815   0.           0.
   1.32951945  12.57208238   8.95194508   1.201373     0.08237986
   0.01601831   0.           0.           2.37757437  13.66590389
   7.48512586   2.92448513   1.12585812   0.13729977   0.           0.
   3.16475973  14.40961098  12.1624714   11.06407323   8.5423341
   1.85125858   0.           0.           2.0617849   14.1006865
  11.15331808   7.49427918  10.51258581   8.08695652   0.15331808   0.
   0.71167048  10.56292906  12.56292906   6.80320366  10.9382151
  10.3798627    0.71167048   0.           0.1006865    2.64530892
  10.9610984   14.41647597  12.24942792   5.14187643   0.23798627]
[  0.00000000e+00   3.08641975e-03   2.28395062e-01   5.50925926e+00
   1.21141975e+01   3.08950617e+00   3.88888889e-01   6.17283951e-02
   0.00000000e+00   2.16049383e-02   2.04938272e+00   1.18734568e+01
   1.00401235e+01   2.06790123e+00   1.71913580e+00   2.99382716e-01
   3.08641975e-03   4.25925926e-01   7.46913580e+00   1.25030864e+01
   3.90123457e+00   5.01234568e+00   4.46604938e+00   2.87037037e-01
   0.00000000e+00   3.23456790e+00   1.30771605e+01   8.07407407e+00
   3.79938272e+00   1.12345679e+01   6.03395062e+00   2.77777778e-02
   1.54320988e-02   7.25617284e+00   1.50123457e+01   9.83950617e+00
   1.11018519e+01   1.46728395e+01   5.02777778e+00   0.00000000e+00
   3.20987654e-01   6.93518519e+00   1.14320988e+01   1.16728395e+01
   1.47592593e+01   1.26975309e+01   2.01543210e+00   0.00000000e+00
   1.94444444e-01   2.18209877e+00   3.66049383e+00   7.05555556e+00
   1.44660494e+01   6.57407407e+00   3.36419753e-01   0.00000000e+00
   0.00000000e+00   4.62962963e-02   3.17901235e-01   6.44753086e+00
   1.25648148e+01   2.90123457e+00   1.54320988e-02   0.00000000e+00]
[  0.00000000e+00   3.86740331e-02   4.01104972e+00   1.34143646e+01
   1.14254144e+01   2.57458564e+00   2.76243094e-02   0.00000000e+00
   1.10497238e-02   1.44198895e+00   1.30055249e+01   1.20718232e+01
   1.08729282e+01   1.03977901e+01   6.18784530e-01   0.00000000e+00
   1.10497238e-02   4.64640884e+00   1.41491713e+01   3.72375691e+00
   2.01104972e+00   1.18839779e+01   3.19889503e+00   0.00000000e+00
   0.00000000e+00   5.72928177e+00   1.22044199e+01   1.19337017e+00
   2.54143646e-01   7.76795580e+00   6.98342541e+00   0.00000000e+00
   0.00000000e+00   5.70165746e+00   1.12099448e+01   5.91160221e-01
   1.54696133e-01   6.27071823e+00   8.30939227e+00   0.00000000e+00
   0.00000000e+00   3.11049724e+00   1.31546961e+01   1.20994475e+00
   3.86740331e-02   8.24309392e+00   8.28176796e+00   5.52486188e-03
   0.00000000e+00   5.96685083e-01   1.26077348e+01   8.88950276e+00
   7.13259669e+00   1.40662983e+01   4.29281768e+00   0.00000000e+00
   0.00000000e+00   0.00000000e+00   4.02762431e+00   1.34364641e+01
   1.45027624e+01   8.04972376e+00   3.92265193e-01   0.00000000e+00]
[  0.           0.02020202   5.16666667  13.05555556  10.6010101
   2.8989899    0.0959596    0.           0.           1.02020202
  13.15656566  13.94444444  13.35858586  10.87878788   0.83838384   0.           0.
   3.34848485  14.71717172   5.42929293   3.75757576  13.04040404
   3.34848485   0.           0.           4.83333333  13.41414141
   2.07575758   0.44949495  10.23232323   6.0959596    0.           0.
   5.09090909  12.66666667   1.32323232   0.17676768  10.61111111
   6.34848485   0.           0.           3.44444444  13.74747475
   2.40909091   2.61616162  13.85858586   4.67171717   0.           0.
   0.8989899   13.52020202  12.05050505  13.51010101  12.62626263
   1.25757576   0.           0.           0.02020202   5.26262626
  13.70707071  12.           3.24242424   0.02525253   0.        ]
[  0.00000000e+00   8.95287958e-01   1.02329843e+01   1.39319372e+01
   7.22513089e+00   1.01570681e+00   2.61780105e-03   0.00000000e+00
   1.30890052e-02   4.80890052e+00   1.43167539e+01   1.26465969e+01
   1.21099476e+01   3.71204188e+00   6.28272251e-02   0.00000000e+00
   0.00000000e+00   4.48167539e+00   8.41361257e+00   4.73298429e+00
   1.15863874e+01   4.84293194e+00   1.43979058e-01   0.00000000e+00
   0.00000000e+00   1.20942408e+00   2.86649215e+00   5.30890052e+00
   1.19083770e+01   3.79842932e+00   3.92670157e-02   0.00000000e+00
   0.00000000e+00   1.23036649e-01   1.17539267e+00   8.69109948e+00
   1.08272251e+01   1.87958115e+00   0.00000000e+00   0.00000000e+00
   0.00000000e+00   1.30890052e-01   4.07853403e+00   1.13848168e+01
   7.98952880e+00   1.72251309e+00   3.21989529e-01   0.00000000e+00
   0.00000000e+00   1.21465969e+00   1.14319372e+01   1.43821990e+01
   1.21178010e+01   1.10052356e+01   7.06806283e+00   5.00000000e-01
   0.00000000e+00   8.66492147e-01   1.03089005e+01   1.41204188e+01
   1.33586387e+01   1.23350785e+01   9.09947644e+00   1.52617801e+00]
[  0.00000000e+00   5.84558824e-01   7.79044118e+00   1.34227941e+01
   1.30055147e+01   6.68566176e+00   1.08455882e+00   1.47058824e-02
   1.83823529e-03   3.54779412e+00   1.32297794e+01   1.01397059e+01
   1.07904412e+01   9.82720588e+00   1.46875000e+00   7.35294118e-03
   1.83823529e-03   2.89154412e+00   8.27022059e+00   4.98529412e+00
   8.49816176e+00   6.80514706e+00   6.36029412e-01   0.00000000e+00
   0.00000000e+00   1.55147059e+00   7.33272059e+00   1.26727941e+01
   1.35992647e+01   4.77757353e+00   1.56250000e-01   0.00000000e+00
   0.00000000e+00   4.13602941e-01   4.16176471e+00   9.03308824e+00
   1.31250000e+01   1.05238971e+01   1.22610294e+00   0.00000000e+00
   0.00000000e+00   2.57352941e-01   2.99632353e+00   1.84007353e+00
   4.63602941e+00   1.34117647e+01   4.29044118e+00   0.00000000e+00
   0.00000000e+00   8.51102941e-01   8.08639706e+00   6.46691176e+00
   8.37500000e+00   1.34613971e+01   4.20036765e+00   1.65441176e-02
   0.00000000e+00   4.83455882e-01   8.56066176e+00   1.41764706e+01
   1.29632353e+01   7.07720588e+00   1.03125000e+00   4.41176471e-02]
[  0.00000000e+00   2.48945148e-01   6.86075949e+00   1.33227848e+01
   1.22088608e+01   4.97679325e+00   7.21518987e-01   1.05485232e-02
   0.00000000e+00   2.74683544e+00   1.34873418e+01   9.95780591e+00
   1.07088608e+01   9.94303797e+00   1.16877637e+00   0.00000000e+00
   0.00000000e+00   3.98734177e+00   1.15295359e+01   5.62658228e+00
   9.22151899e+00   1.14514768e+01   1.64978903e+00   0.00000000e+00
   0.00000000e+00   1.98734177e+00   9.17510549e+00   1.07721519e+01
   1.28354430e+01   1.36898734e+01   2.78481013e+00   0.00000000e+00
   0.00000000e+00   2.06751055e-01   2.17932489e+00   4.02742616e+00
   5.53164557e+00   1.32784810e+01   5.79113924e+00   0.00000000e+00
   0.00000000e+00   1.37130802e-01   8.62869198e-01   3.75527426e-01
   1.33966245e+00   1.07215190e+01   8.06751055e+00   1.68776371e-02
   0.00000000e+00   7.74261603e-01   6.95569620e+00   5.94936709e+00
   6.72362869e+00   1.27742616e+01   6.90084388e+00   1.18143460e-01
   0.00000000e+00   2.00421941e-01   6.98945148e+00   1.35717300e+01
   1.36940928e+01   9.58649789e+00   2.48523207e+00   1.26582278e-01]
[  0.00000000e+00   4.41908714e-01   7.14730290e+00   1.33423237e+01
   1.37800830e+01   1.16452282e+01   5.74896266e+00   8.69294606e-01
   0.00000000e+00   1.42116183e+00   9.71991701e+00   1.01763485e+01
   9.83195021e+00   1.30975104e+01   7.74273859e+00   7.36514523e-01
   2.07468880e-03   1.26556017e+00   3.39211618e+00   1.31950207e+00
   6.22406639e+00   1.24834025e+01   4.56224066e+00   9.54356846e-02
   0.00000000e+00   1.01037344e+00   4.57883817e+00   7.17842324e+00
   1.23506224e+01   1.20684647e+01   3.80705394e+00   4.14937759e-03
   0.00000000e+00   1.36307054e+00   8.02489627e+00   1.32406639e+01
   1.46244813e+01   1.12593361e+01   3.94398340e+00   0.00000000e+00
   0.00000000e+00   6.55601660e-01   3.78838174e+00   1.18195021e+01
   1.04377593e+01   3.50414938e+00   5.82987552e-01   0.00000000e+00
   0.00000000e+00   2.15767635e-01   5.06016598e+00   1.32614108e+01
   5.36099585e+00   5.89211618e-01   1.86721992e-02   0.00000000e+00
   0.00000000e+00   4.58506224e-01   8.42738589e+00   1.15871369e+01
   2.02489627e+00   2.92531120e-01   1.86721992e-02   0.00000000e+00]
[  0.00000000e+00   1.39372822e-02   6.55052265e-01   5.22299652e+00
   1.23101045e+01   1.08292683e+01   3.16376307e+00   2.85714286e-01
   0.00000000e+00   3.27526132e-01   4.69686411e+00   1.10209059e+01
   1.23972125e+01   1.25331010e+01   5.16027875e+00   3.72822300e-01
   0.00000000e+00   1.63763066e+00   9.17073171e+00   1.08571429e+01
   1.12473868e+01   1.21846690e+01   3.81881533e+00   1.42857143e-01
   0.00000000e+00   3.62020906e+00   1.19512195e+01   1.30418118e+01
   1.39930314e+01   1.22787456e+01   3.24041812e+00   3.48432056e-03
   0.00000000e+00   2.25435540e+00   7.24041812e+00   8.56794425e+00
   1.24738676e+01   1.19512195e+01   1.66898955e+00   0.00000000e+00
   3.48432056e-03   3.65853659e-01   1.34494774e+00   4.03484321e+00
   1.31428571e+01   1.03832753e+01   4.70383275e-01   0.00000000e+00
   0.00000000e+00   6.27177700e-02   6.27177700e-01   5.67944251e+00
   1.42682927e+01   8.54703833e+00   6.65505226e-01   0.00000000e+00
   0.00000000e+00   2.09059233e-02   5.92334495e-01   5.98954704e+00
   1.10243902e+01   6.90940767e+00   1.18815331e+00   0.00000000e+00]
[  0.00000000e+00   2.08171206e-01   5.71206226e+00   1.29085603e+01
   1.22217899e+01   6.19844358e+00   9.20233463e-01   1.94552529e-02
   0.00000000e+00   1.87937743e+00   1.16108949e+01   1.33929961e+01
   1.20544747e+01   9.89299611e+00   1.82295720e+00   3.50194553e-02
   2.72373541e-02   2.81322957e+00   1.12704280e+01   9.91634241e+00
   9.58949416e+00   7.55252918e+00   1.26070039e+00   1.55642023e-02
   7.78210117e-03   2.08949416e+00   1.00719844e+01   1.39552529e+01
   1.23287938e+01   5.12451362e+00   5.36964981e-01   0.00000000e+00
   0.00000000e+00   7.04280156e-01   7.57198444e+00   1.45155642e+01
   1.27178988e+01   3.60894942e+00   2.80155642e-01   0.00000000e+00
   0.00000000e+00   5.93385214e-01   7.59922179e+00   1.11712062e+01
   1.30155642e+01   4.89299611e+00   2.17898833e-01   0.00000000e+00
   9.72762646e-03   8.07392996e-01   9.02723735e+00   1.20000000e+01
   1.29455253e+01   6.25486381e+00   3.61867704e-01   0.00000000e+00
   1.94552529e-03   2.00389105e-01   6.25875486e+00   1.32101167e+01
   1.10077821e+01   3.87937743e+00   3.05447471e-01   3.89105058e-03]
~~~
可以看到二分均值算法最终的轮廓系数没有k-means算法好。也可以使用肘部观察法去选择最佳的k值
