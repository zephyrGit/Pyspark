
1. pyspark.sql.DataFrameNaFunctions(df)这个模块主要用来对DataFrame中的Na数据做处理。在数据分析中缺失数据的处理是很重要的。因此spark提供了一个方法集合，通过这个模块可以对缺失的数据进行处理

2. 在DataFrame上可以通过na这个属性得到DataFrameNaFunctions这个对象的引用

~~~python
df = spark.range(0, 10 ,2 ,3)
df.na
>>> <pyspark.sql.dataframe.DataFrameNaFunctions at 0x1f79f8ac9b0>
~~~

3. drop(how='any', thresh=None, subset=None),用于删除na数据。how用于指定删除的策略有any，all选项；thresh指定na数量占到多大的比例删除，subset用于指定的列上面进行查找na数据并删除，这个地方适用谷歌商店数据集，上传到hdfs的/sql/目录下

~~~shell
root@hadoop-maste：~# head googleplaystore.csv
>>> .......
root@hadoop-maste：hdfs dfs -put googleplaystore.csv /sql/
~~~
~~~python
df = spark.read.csv('./datas/googleplaystore.csv', header=True)
df.show()
>>> 
+--------------------+--------------+------+-------+----+-----------+----+-----+--------------+--------------------+------------------+------------------+------------+
|                 App|      Category|Rating|Reviews|Size|   Installs|Type|Price|Content Rating|              Genres|      Last Updated|       Current Ver| Android Ver|
+--------------------+--------------+------+-------+----+-----------+----+-----+--------------+--------------------+------------------+------------------+------------+
|Photo Editor & Ca...|ART_AND_DESIGN|   4.1|    159| 19M|    10,000+|Free|    0|      Everyone|        Art & Design|   January 7, 2018|             1.0.0|4.0.3 and up|
| Coloring book moana|ART_AND_DESIGN|   3.9|    967| 14M|   500,000+|Free|    0|      Everyone|Art & Design;Pret...|  January 15, 2018|             2.0.0|4.0.3 and up|
|U Launcher Lite –...|ART_AND_DESIGN|   4.7|  87510|8.7M| 5,000,000+|Free|    0|      Everyone|        Art & Design|    August 1, 2018|             1.2.4|4.0.3 and up|
|Sketch - Draw & P...|ART_AND_DESIGN|   4.5| 215644| 25M|50,000,000+|Free|    0|          Teen|        Art & Design|      June 8, 2018|Varies with device|  4.2 and up|
|Pixel Draw - Numb...|ART_AND_DESIGN|   4.3|    967|2.8M|   100,000+|Free|    0|      Everyone|Art & Design;Crea...|     June 20, 2018|               1.1|  4.4 and up|
|Paper flowers ins...|ART_AND_DESIGN|   4.4|    167|5.6M|    50,000+|Free|    0|      Everyone|        Art & Design|    March 26, 2017|               1.0|  2.3 and up|
|Smoke Effect Phot...|ART_AND_DESIGN|   3.8|    178| 19M|    50,000+|Free|    0|      Everyone|        Art & Design|    April 26, 2018|               1.1|4.0.3 and up|
|    Infinite Painter|ART_AND_DESIGN|   4.1|  36815| 29M| 1,000,000+|Free|    0|      Everyone|        Art & Design|     June 14, 2018|          6.1.61.1|  4.2 and up|
|Garden Coloring Book|ART_AND_DESIGN|   4.4|  13791| 33M| 1,000,000+|Free|    0|      Everyone|        Art & Design|September 20, 2017|             2.9.2|  3.0 and up|
|Kids Paint Free -...|ART_AND_DESIGN|   4.7|    121|3.1M|    10,000+|Free|    0|      Everyone|Art & Design;Crea...|      July 3, 2018|               2.8|4.0.3 and up|
|Text on Photo - F...|ART_AND_DESIGN|   4.4|  13880| 28M| 1,000,000+|Free|    0|      Everyone|        Art & Design|  October 27, 2017|             1.0.4|  4.1 and up|
|Name Art Photo Ed...|ART_AND_DESIGN|   4.4|   8788| 12M| 1,000,000+|Free|    0|      Everyone|        Art & Design|     July 31, 2018|            1.0.15|  4.0 and up|
|Tattoo Name On My...|ART_AND_DESIGN|   4.2|  44829| 20M|10,000,000+|Free|    0|          Teen|        Art & Design|     April 2, 2018|               3.8|  4.1 and up|
|Mandala Coloring ...|ART_AND_DESIGN|   4.6|   4326| 21M|   100,000+|Free|    0|      Everyone|        Art & Design|     June 26, 2018|             1.0.4|  4.4 and up|
|3D Color Pixel by...|ART_AND_DESIGN|   4.4|   1518| 37M|   100,000+|Free|    0|      Everyone|        Art & Design|    August 3, 2018|             1.2.3|  2.3 and up|
|Learn To Draw Kaw...|ART_AND_DESIGN|   3.2|     55|2.7M|     5,000+|Free|    0|      Everyone|        Art & Design|      June 6, 2018|               NaN|  4.2 and up|
|Photo Designer - ...|ART_AND_DESIGN|   4.7|   3632|5.5M|   500,000+|Free|    0|      Everyone|        Art & Design|     July 31, 2018|               3.1|  4.1 and up|
|350 Diy Room Deco...|ART_AND_DESIGN|   4.5|     27| 17M|    10,000+|Free|    0|      Everyone|        Art & Design|  November 7, 2017|               1.0|  2.3 and up|
|FlipaClip - Carto...|ART_AND_DESIGN|   4.3| 194216| 39M| 5,000,000+|Free|    0|      Everyone|        Art & Design|    August 3, 2018|             2.2.5|4.0.3 and up|
|        ibis Paint X|ART_AND_DESIGN|   4.6| 224399| 31M|10,000,000+|Free|    0|      Everyone|        Art & Design|     July 30, 2018|             5.5.4|  4.1 and up|
+--------------------+--------------+------+-------+----+-----------+----+-----+--------------+--------------------+------------------+------------------+------------+
only showing top 20 rows
~~~
在这份数据集中存在很多null空数据
~~~python
df.toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 10841 entries, 0 to 10840
Data columns (total 13 columns):
App               10841 non-null object
Category          10841 non-null object
Rating            10841 non-null object
Reviews           10841 non-null object
Size              10841 non-null object
Installs          10841 non-null object
Type              10841 non-null object
Price             10841 non-null object
Content Rating    10840 non-null object
Genres            10841 non-null object
Last Updated      10841 non-null object
Current Ver       10840 non-null object
Android Ver       10840 non-null object
dtypes: object(13)
memory usage: 1.1+ MB
~~~
适用any这种策略，删除一行数据中之哟啊存在空数据的
~~~python
df.na.drop(how='any').toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 10839 entries, 0 to 10838
Data columns (total 13 columns):
App               10839 non-null object
Category          10839 non-null object
Rating            10839 non-null object
Reviews           10839 non-null object
Size              10839 non-null object
Installs          10839 non-null object
Type              10839 non-null object
Price             10839 non-null object
Content Rating    10839 non-null object
Genres            10839 non-null object
Last Updated      10839 non-null object
Current Ver       10839 non-null object
Android Ver       10839 non-null object
dtypes: object(13)
memory usage: 1.1+ MB
~~~

可以看到删掉了很多有用的信息，这是不妥的，在来试一下all这种策略，一行所有的值都为null才删除
~~~python
df.na.drop(how='all').toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 10841 entries, 0 to 10840
Data columns (total 13 columns):
App               10841 non-null object
Category          10841 non-null object
Rating            10841 non-null object
Reviews           10841 non-null object
Size              10841 non-null object
Installs          10841 non-null object
Type              10841 non-null object
Price             10841 non-null object
Content Rating    10840 non-null object
Genres            10841 non-null object
Last Updated      10841 non-null object
Current Ver       10840 non-null object
Android Ver       10840 non-null object
dtypes: object(13)
memory usage: 1.1+ MB
~~~
可以看到数据的行数基本上没有变化，没有删除任何数据，接下来尝试指定阈值thresh，一行中超过这个阈值的就删除，subset关键字指定列

~~~python
df.na.drop(how='all', thresh=1, subset=['Content Rating']).toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 10840 entries, 0 to 10839
Data columns (total 13 columns):
App               10840 non-null object
Category          10840 non-null object
Rating            10840 non-null object
Reviews           10840 non-null object
Size              10840 non-null object
Installs          10840 non-null object
Type              10840 non-null object
Price             10840 non-null object
Content Rating    10840 non-null object
Genres            10840 non-null object
Last Updated      10840 non-null object
Current Ver       10839 non-null object
Android Ver       10840 non-null object
dtypes: object(13)
memory usage: 1.1+ MB
~~~
df.na中的drop方法同DataFrame上的dropna方法互为别名

4.当然直接删除数据是最笨的办法，因为这样会损失掉一些有用的信息，更好的办法是对数据进行填充，类似于在Pandas中一样，可以使用均值，中位数等来进行填充，甚至可以根据其他缺失不严重的特征训练一个模型去推测出缺失值  
fill(value, subset=None), pyspark中可以适用fill方法来对数据缺失值进行填补

~~~python
df1 = df.na.fill('unknown')
df1.toPandas().info().show()
~~~

还可以指定对于不同的列填充不同的值

~~~python
df1 = df.na.fill({'Rating':4.0, 'Size': 5.5M})
df1.show(20)
~~~

df.na上的fill方法同DataFrame上的fill方法互为别名

~~~python
df2 = df.fillna({'Rating':4.0, 'Size': 5.5M})
df2.show()
~~~

5. replace(to_replace, value=<no value>, subset=None) 这个方法通过第一个参数指定要被替换掉的值，第二个参数为参数指定新的值，subset关键字参数指定子集，默认是DataFrame上进行替换。把数据集中的99替换为100
    
~~~python
df = spark.read.csv('./datas/customers.csv', header=True)
df.columns
>>> ['CustomerID', 'Genre', 'Age', 'Annual Income (k$)', 'Spending Score (1-100)']
df.show()
>>> 
+----------+------+---+------------------+----------------------+
|CustomerID| Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+------+---+------------------+----------------------+
|      0001|  Male| 19|                15|                    39|
|      0002|  Male| 21|                15|                    81|
|      0003|Female| 20|                16|                     6|
|      0004|Female| 23|                16|                    77|
|      0005|Female| 31|                17|                    40|
|      0006|Female| 22|                17|                    76|
|      0007|Female| 35|                18|                     6|
|      0008|Female| 23|                18|                    94|
|      0009|  Male| 64|                19|                     3|
|      0010|Female| 30|                19|                    72|
|      0011|  Male| 67|                19|                    14|
|      0012|Female| 35|                19|                    99|
|      0013|Female| 58|                20|                    15|
|      0014|Female| 24|                20|                    77|
|      0015|  Male| 37|                20|                    13|
|      0016|  Male| 22|                20|                    79|
|      0017|Female| 35|                21|                    35|
|      0018|  Male| 20|                21|                    66|
|      0019|  Male| 52|                23|                    29|
|      0020|Female| 35|                23|                    98|
+----------+------+---+------------------+----------------------+
only showing top 20 rows
     
df.na.replace('99', '100').show()
>>> 
+----------+------+---+------------------+----------------------+
|CustomerID| Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+------+---+------------------+----------------------+
|      0001|  Male| 19|                15|                    39|
|      0002|  Male| 21|                15|                    81|
|      0003|Female| 20|                16|                     6|
|      0004|Female| 23|                16|                    77|
|      0005|Female| 31|                17|                    40|
|      0006|Female| 22|                17|                    76|
|      0007|Female| 35|                18|                     6|
|      0008|Female| 23|                18|                    94|
|      0009|  Male| 64|                19|                     3|
|      0010|Female| 30|                19|                    72|
|      0011|  Male| 67|                19|                    14|
|      0012|Female| 35|                19|                   100|
|      0013|Female| 58|                20|                    15|
|      0014|Female| 24|                20|                    77|
|      0015|  Male| 37|                20|                    13|
|      0016|  Male| 22|                20|                    79|
|      0017|Female| 35|                21|                    35|
|      0018|  Male| 20|                21|                    66|
|      0019|  Male| 52|                23|                    29|
|      0020|Female| 35|                23|                    98|
+----------+------+---+------------------+----------------------+
only showing top 20 rows
~~~
注意上面在替换的过程中to_replace和value的类型必须要相同，而且to_replace数据类型只能是：bool、int、long、float、string、list or dict。value数据类型只能是：bool、int、float、string、list or None

~~~python
df.replace(['Female', 'Male'], ['F', 'M']).show()
>>> 
+----------+-----+---+------------------+----------------------+
|CustomerID|Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+-----+---+------------------+----------------------+
|      0001|    M| 19|                15|                    39|
|      0002|    M| 21|                15|                    81|
|      0003|    F| 20|                16|                     6|
|      0004|    F| 23|                16|                    77|
|      0005|    F| 31|                17|                    40|
|      0006|    F| 22|                17|                    76|
|      0007|    F| 35|                18|                     6|
|      0008|    F| 23|                18|                    94|
|      0009|    M| 64|                19|                     3|
|      0010|    F| 30|                19|                    72|
|      0011|    M| 67|                19|                    14|
|      0012|    F| 35|                19|                    99|
|      0013|    F| 58|                20|                    15|
|      0014|    F| 24|                20|                    77|
|      0015|    M| 37|                20|                    13|
|      0016|    M| 22|                20|                    79|
|      0017|    F| 35|                21|                    35|
|      0018|    M| 20|                21|                    66|
|      0019|    M| 52|                23|                    29|
|      0020|    F| 35|                23|                    98|
+----------+-----+---+------------------+----------------------+
only showing top 20 rows

df.na.replace(['Female', 'Male'], ['F', 'M']).show()
>>> 
+----------+-----+---+------------------+----------------------+
|CustomerID|Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+-----+---+------------------+----------------------+
|      0001|    M| 19|                15|                    39|
|      0002|    M| 21|                15|                    81|
|      0003|    F| 20|                16|                     6|
|      0004|    F| 23|                16|                    77|
|      0005|    F| 31|                17|                    40|
|      0006|    F| 22|                17|                    76|
|      0007|    F| 35|                18|                     6|
|      0008|    F| 23|                18|                    94|
|      0009|    M| 64|                19|                     3|
|      0010|    F| 30|                19|                    72|
|      0011|    M| 67|                19|                    14|
|      0012|    F| 35|                19|                    99|
|      0013|    F| 58|                20|                    15|
|      0014|    F| 24|                20|                    77|
|      0015|    M| 37|                20|                    13|
|      0016|    M| 22|                20|                    79|
|      0017|    F| 35|                21|                    35|
|      0018|    M| 20|                21|                    66|
|      0019|    M| 52|                23|                    29|
|      0020|    F| 35|                23|                    98|
+----------+-----+---+------------------+----------------------+
only showing top 20 rows
~~~
