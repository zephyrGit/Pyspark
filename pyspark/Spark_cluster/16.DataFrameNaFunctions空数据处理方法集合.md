
1. pyspark.sql.DataFrameNaFunctions(df)这个模块主要用来对DataFrame中的Na数据做处理。在数据分析中缺失数据的处理是很重要的。因此spark提供了一个方法集合，通过这个模块可以对缺失的数据进行处理

2. 在DataFrame上可以通过na这个属性得到DataFrameNaFunctions这个对象的引用

~~~python
df = spark.range(0, 10 ,2 ,3)
df.na
>>> <pyspark.sql.dataframe.DataFrameNaFunctions at 0x1f79f8ac9b0>
~~~

3. drop(how='any', thresh=None, subset=None),用于删除na数据。how用于指定删除的策略有any，all选项；thresh指定na数量占到多大的比例删除，subset用于指定的列上面进行查找na数据并删除，这个地方适用谷歌商店数据集，上传到hdfs的/sql/目录下

~~~shell
root@hadoop-maste：~# head googleplaystore.csv
>>> .......
root@hadoop-maste：hdfs dfs -put googleplaystore.csv /sql/
~~~
~~~python
df = spark.read.csv('./datas/titanic_train.csv', header=True)
df.show()
>>> 
+-----------+--------+------+--------------------+------+----+-----+-----+----------------+-------+-----+--------+
|PassengerId|Survived|Pclass|                Name|   Sex| Age|SibSp|Parch|          Ticket|   Fare|Cabin|Embarked|
+-----------+--------+------+--------------------+------+----+-----+-----+----------------+-------+-----+--------+
|          1|       0|     3|Braund, Mr. Owen ...|  male|  22|    1|    0|       A/5 21171|   7.25| null|       S|
|          2|       1|     1|Cumings, Mrs. Joh...|female|  38|    1|    0|        PC 17599|71.2833|  C85|       C|
|          3|       1|     3|Heikkinen, Miss. ...|female|  26|    0|    0|STON/O2. 3101282|  7.925| null|       S|
|          4|       1|     1|Futrelle, Mrs. Ja...|female|  35|    1|    0|          113803|   53.1| C123|       S|
|          5|       0|     3|Allen, Mr. Willia...|  male|  35|    0|    0|          373450|   8.05| null|       S|
|          6|       0|     3|    Moran, Mr. James|  male|null|    0|    0|          330877| 8.4583| null|       Q|
|          7|       0|     1|McCarthy, Mr. Tim...|  male|  54|    0|    0|           17463|51.8625|  E46|       S|
|          8|       0|     3|Palsson, Master. ...|  male|   2|    3|    1|          349909| 21.075| null|       S|
|          9|       1|     3|Johnson, Mrs. Osc...|female|  27|    0|    2|          347742|11.1333| null|       S|
|         10|       1|     2|Nasser, Mrs. Nich...|female|  14|    1|    0|          237736|30.0708| null|       C|
|         11|       1|     3|Sandstrom, Miss. ...|female|   4|    1|    1|         PP 9549|   16.7|   G6|       S|
|         12|       1|     1|Bonnell, Miss. El...|female|  58|    0|    0|          113783|  26.55| C103|       S|
|         13|       0|     3|Saundercock, Mr. ...|  male|  20|    0|    0|       A/5. 2151|   8.05| null|       S|
|         14|       0|     3|Andersson, Mr. An...|  male|  39|    1|    5|          347082| 31.275| null|       S|
|         15|       0|     3|Vestrom, Miss. Hu...|female|  14|    0|    0|          350406| 7.8542| null|       S|
|         16|       1|     2|Hewlett, Mrs. (Ma...|female|  55|    0|    0|          248706|     16| null|       S|
|         17|       0|     3|Rice, Master. Eugene|  male|   2|    4|    1|          382652| 29.125| null|       Q|
|         18|       1|     2|Williams, Mr. Cha...|  male|null|    0|    0|          244373|     13| null|       S|
|         19|       0|     3|Vander Planke, Mr...|female|  31|    1|    0|          345763|     18| null|       S|
|         20|       1|     3|Masselmani, Mrs. ...|female|null|    0|    0|            2649|  7.225| null|       C|
+-----------+--------+------+--------------------+------+----+-----+-----+----------------+-------+-----+--------+
only showing top 20 rows

~~~
在这份数据集中存在很多null空数据
~~~python
df.toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
PassengerId    891 non-null object
Survived       891 non-null object
Pclass         891 non-null object
Name           891 non-null object
Sex            891 non-null object
Age            714 non-null object
SibSp          891 non-null object
Parch          891 non-null object
Ticket         891 non-null object
Fare           891 non-null object
Cabin          204 non-null object
Embarked       889 non-null object
dtypes: object(12)
memory usage: 83.6+ KB
~~~
适用any这种策略，删除一行数据中之哟啊存在空数据的
~~~python
df.na.drop(how='any').toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 183 entries, 0 to 182
Data columns (total 12 columns):
PassengerId    183 non-null object
Survived       183 non-null object
Pclass         183 non-null object
Name           183 non-null object
Sex            183 non-null object
Age            183 non-null object
SibSp          183 non-null object
Parch          183 non-null object
Ticket         183 non-null object
Fare           183 non-null object
Cabin          183 non-null object
Embarked       183 non-null object
dtypes: object(12)
memory usage: 17.2+ KB
~~~

可以看到删掉了很多有用的信息，这是不妥的，在来试一下all这种策略，一行所有的值都为null才删除
~~~python
df.na.drop(how='all').toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
PassengerId    891 non-null object
Survived       891 non-null object
Pclass         891 non-null object
Name           891 non-null object
Sex            891 non-null object
Age            714 non-null object
SibSp          891 non-null object
Parch          891 non-null object
Ticket         891 non-null object
Fare           891 non-null object
Cabin          204 non-null object
Embarked       889 non-null object
dtypes: object(12)
memory usage: 83.6+ KB
~~~
可以看到数据的行数基本上没有变化，没有删除任何数据，接下来尝试指定阈值thresh，一行中超过这个阈值的就删除，subset关键字指定列

~~~python
df.na.drop(how='all', thresh=1, subset=['Age', 'Cabin']).toPandas().info()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 733 entries, 0 to 732
Data columns (total 12 columns):
PassengerId    733 non-null object
Survived       733 non-null object
Pclass         733 non-null object
Name           733 non-null object
Sex            733 non-null object
Age            714 non-null object
SibSp          733 non-null object
Parch          733 non-null object
Ticket         733 non-null object
Fare           733 non-null object
Cabin          204 non-null object
Embarked       731 non-null object
dtypes: object(12)
memory usage: 68.8+ KB
~~~
df.na中的drop方法同DataFrame上的dropna方法互为别名

4.当然直接删除数据是最笨的办法，因为这样会损失掉一些有用的信息，更好的办法是对数据进行填充，类似于在Pandas中一样，可以使用均值，中位数等来进行填充，甚至可以根据其他缺失不严重的特征训练一个模型去推测出缺失值  
fill(value, subset=None), pyspark中可以适用fill方法来对数据缺失值进行填补

~~~python
df1 = df.na.fill('unknown')
df1.toPandas().info()
df1.show()
>>> 
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
PassengerId    891 non-null object
Survived       891 non-null object
Pclass         891 non-null object
Name           891 non-null object
Sex            891 non-null object
Age            891 non-null object
SibSp          891 non-null object
Parch          891 non-null object
Ticket         891 non-null object
Fare           891 non-null object
Cabin          891 non-null object
Embarked       891 non-null object
dtypes: object(12)
memory usage: 83.6+ KB
~~~

还可以指定对于不同的列填充不同的值

~~~python
df1 = df.na.fill({'Age': 40, 'Cabin': 'UNKOWN'})
df1.show()
>>> 
+-----------+--------+------+--------------------+------+---+-----+-----+----------------+-------+------+--------+
|PassengerId|Survived|Pclass|                Name|   Sex|Age|SibSp|Parch|          Ticket|   Fare| Cabin|Embarked|
+-----------+--------+------+--------------------+------+---+-----+-----+----------------+-------+------+--------+
|          1|       0|     3|Braund, Mr. Owen ...|  male| 22|    1|    0|       A/5 21171|   7.25|UNKOWN|       S|
|          2|       1|     1|Cumings, Mrs. Joh...|female| 38|    1|    0|        PC 17599|71.2833|   C85|       C|
|          3|       1|     3|Heikkinen, Miss. ...|female| 26|    0|    0|STON/O2. 3101282|  7.925|UNKOWN|       S|
|          4|       1|     1|Futrelle, Mrs. Ja...|female| 35|    1|    0|          113803|   53.1|  C123|       S|
|          5|       0|     3|Allen, Mr. Willia...|  male| 35|    0|    0|          373450|   8.05|UNKOWN|       S|
|          6|       0|     3|    Moran, Mr. James|  male| 40|    0|    0|          330877| 8.4583|UNKOWN|       Q|
|          7|       0|     1|McCarthy, Mr. Tim...|  male| 54|    0|    0|           17463|51.8625|   E46|       S|
|          8|       0|     3|Palsson, Master. ...|  male|  2|    3|    1|          349909| 21.075|UNKOWN|       S|
|          9|       1|     3|Johnson, Mrs. Osc...|female| 27|    0|    2|          347742|11.1333|UNKOWN|       S|
|         10|       1|     2|Nasser, Mrs. Nich...|female| 14|    1|    0|          237736|30.0708|UNKOWN|       C|
|         11|       1|     3|Sandstrom, Miss. ...|female|  4|    1|    1|         PP 9549|   16.7|    G6|       S|
|         12|       1|     1|Bonnell, Miss. El...|female| 58|    0|    0|          113783|  26.55|  C103|       S|
|         13|       0|     3|Saundercock, Mr. ...|  male| 20|    0|    0|       A/5. 2151|   8.05|UNKOWN|       S|
|         14|       0|     3|Andersson, Mr. An...|  male| 39|    1|    5|          347082| 31.275|UNKOWN|       S|
|         15|       0|     3|Vestrom, Miss. Hu...|female| 14|    0|    0|          350406| 7.8542|UNKOWN|       S|
|         16|       1|     2|Hewlett, Mrs. (Ma...|female| 55|    0|    0|          248706|     16|UNKOWN|       S|
|         17|       0|     3|Rice, Master. Eugene|  male|  2|    4|    1|          382652| 29.125|UNKOWN|       Q|
|         18|       1|     2|Williams, Mr. Cha...|  male| 40|    0|    0|          244373|     13|UNKOWN|       S|
|         19|       0|     3|Vander Planke, Mr...|female| 31|    1|    0|          345763|     18|UNKOWN|       S|
|         20|       1|     3|Masselmani, Mrs. ...|female| 40|    0|    0|            2649|  7.225|UNKOWN|       C|
+-----------+--------+------+--------------------+------+---+-----+-----+----------------+-------+------+--------+
only showing top 20 rows
~~~

df.na上的fill方法同DataFrame上的fill方法互为别名

~~~python
df2 = df.fillna({'Age': 40, 'Cabin': 'UNKOWN'})
df2.show()
>>> 
+-----------+--------+------+--------------------+------+---+-----+-----+----------------+-------+------+--------+
|PassengerId|Survived|Pclass|                Name|   Sex|Age|SibSp|Parch|          Ticket|   Fare| Cabin|Embarked|
+-----------+--------+------+--------------------+------+---+-----+-----+----------------+-------+------+--------+
|          1|       0|     3|Braund, Mr. Owen ...|  male| 22|    1|    0|       A/5 21171|   7.25|UNKOWN|       S|
|          2|       1|     1|Cumings, Mrs. Joh...|female| 38|    1|    0|        PC 17599|71.2833|   C85|       C|
|          3|       1|     3|Heikkinen, Miss. ...|female| 26|    0|    0|STON/O2. 3101282|  7.925|UNKOWN|       S|
|          4|       1|     1|Futrelle, Mrs. Ja...|female| 35|    1|    0|          113803|   53.1|  C123|       S|
|          5|       0|     3|Allen, Mr. Willia...|  male| 35|    0|    0|          373450|   8.05|UNKOWN|       S|
|          6|       0|     3|    Moran, Mr. James|  male| 40|    0|    0|          330877| 8.4583|UNKOWN|       Q|
|          7|       0|     1|McCarthy, Mr. Tim...|  male| 54|    0|    0|           17463|51.8625|   E46|       S|
|          8|       0|     3|Palsson, Master. ...|  male|  2|    3|    1|          349909| 21.075|UNKOWN|       S|
|          9|       1|     3|Johnson, Mrs. Osc...|female| 27|    0|    2|          347742|11.1333|UNKOWN|       S|
|         10|       1|     2|Nasser, Mrs. Nich...|female| 14|    1|    0|          237736|30.0708|UNKOWN|       C|
|         11|       1|     3|Sandstrom, Miss. ...|female|  4|    1|    1|         PP 9549|   16.7|    G6|       S|
|         12|       1|     1|Bonnell, Miss. El...|female| 58|    0|    0|          113783|  26.55|  C103|       S|
|         13|       0|     3|Saundercock, Mr. ...|  male| 20|    0|    0|       A/5. 2151|   8.05|UNKOWN|       S|
|         14|       0|     3|Andersson, Mr. An...|  male| 39|    1|    5|          347082| 31.275|UNKOWN|       S|
|         15|       0|     3|Vestrom, Miss. Hu...|female| 14|    0|    0|          350406| 7.8542|UNKOWN|       S|
|         16|       1|     2|Hewlett, Mrs. (Ma...|female| 55|    0|    0|          248706|     16|UNKOWN|       S|
|         17|       0|     3|Rice, Master. Eugene|  male|  2|    4|    1|          382652| 29.125|UNKOWN|       Q|
|         18|       1|     2|Williams, Mr. Cha...|  male| 40|    0|    0|          244373|     13|UNKOWN|       S|
|         19|       0|     3|Vander Planke, Mr...|female| 31|    1|    0|          345763|     18|UNKOWN|       S|
|         20|       1|     3|Masselmani, Mrs. ...|female| 40|    0|    0|            2649|  7.225|UNKOWN|       C|
+-----------+--------+------+--------------------+------+---+-----+-----+----------------+-------+------+--------+
only showing top 20 rows
~~~

5. replace(to_replace, value=<no value>, subset=None) 这个方法通过第一个参数指定要被替换掉的值，第二个参数为参数指定新的值，subset关键字参数指定子集，默认是DataFrame上进行替换。把数据集中的99替换为100
    
~~~python
df = spark.read.csv('./datas/customers.csv', header=True)
df.columns
>>> ['CustomerID', 'Genre', 'Age', 'Annual Income (k$)', 'Spending Score (1-100)']
df.show()
>>> 
+----------+------+---+------------------+----------------------+
|CustomerID| Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+------+---+------------------+----------------------+
|      0001|  Male| 19|                15|                    39|
|      0002|  Male| 21|                15|                    81|
|      0003|Female| 20|                16|                     6|
|      0004|Female| 23|                16|                    77|
|      0005|Female| 31|                17|                    40|
|      0006|Female| 22|                17|                    76|
|      0007|Female| 35|                18|                     6|
|      0008|Female| 23|                18|                    94|
|      0009|  Male| 64|                19|                     3|
|      0010|Female| 30|                19|                    72|
|      0011|  Male| 67|                19|                    14|
|      0012|Female| 35|                19|                    99|
|      0013|Female| 58|                20|                    15|
|      0014|Female| 24|                20|                    77|
|      0015|  Male| 37|                20|                    13|
|      0016|  Male| 22|                20|                    79|
|      0017|Female| 35|                21|                    35|
|      0018|  Male| 20|                21|                    66|
|      0019|  Male| 52|                23|                    29|
|      0020|Female| 35|                23|                    98|
+----------+------+---+------------------+----------------------+
only showing top 20 rows
     
df.na.replace('99', '100').show()
>>> 
+----------+------+---+------------------+----------------------+
|CustomerID| Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+------+---+------------------+----------------------+
|      0001|  Male| 19|                15|                    39|
|      0002|  Male| 21|                15|                    81|
|      0003|Female| 20|                16|                     6|
|      0004|Female| 23|                16|                    77|
|      0005|Female| 31|                17|                    40|
|      0006|Female| 22|                17|                    76|
|      0007|Female| 35|                18|                     6|
|      0008|Female| 23|                18|                    94|
|      0009|  Male| 64|                19|                     3|
|      0010|Female| 30|                19|                    72|
|      0011|  Male| 67|                19|                    14|
|      0012|Female| 35|                19|                   100|
|      0013|Female| 58|                20|                    15|
|      0014|Female| 24|                20|                    77|
|      0015|  Male| 37|                20|                    13|
|      0016|  Male| 22|                20|                    79|
|      0017|Female| 35|                21|                    35|
|      0018|  Male| 20|                21|                    66|
|      0019|  Male| 52|                23|                    29|
|      0020|Female| 35|                23|                    98|
+----------+------+---+------------------+----------------------+
only showing top 20 rows
~~~
注意上面在替换的过程中to_replace和value的类型必须要相同，而且to_replace数据类型只能是：bool、int、long、float、string、list or dict。value数据类型只能是：bool、int、float、string、list or None

~~~python
df.replace(['Female', 'Male'], ['F', 'M']).show()
>>> 
+----------+-----+---+------------------+----------------------+
|CustomerID|Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+-----+---+------------------+----------------------+
|      0001|    M| 19|                15|                    39|
|      0002|    M| 21|                15|                    81|
|      0003|    F| 20|                16|                     6|
|      0004|    F| 23|                16|                    77|
|      0005|    F| 31|                17|                    40|
|      0006|    F| 22|                17|                    76|
|      0007|    F| 35|                18|                     6|
|      0008|    F| 23|                18|                    94|
|      0009|    M| 64|                19|                     3|
|      0010|    F| 30|                19|                    72|
|      0011|    M| 67|                19|                    14|
|      0012|    F| 35|                19|                    99|
|      0013|    F| 58|                20|                    15|
|      0014|    F| 24|                20|                    77|
|      0015|    M| 37|                20|                    13|
|      0016|    M| 22|                20|                    79|
|      0017|    F| 35|                21|                    35|
|      0018|    M| 20|                21|                    66|
|      0019|    M| 52|                23|                    29|
|      0020|    F| 35|                23|                    98|
+----------+-----+---+------------------+----------------------+
only showing top 20 rows

df.na.replace(['Female', 'Male'], ['F', 'M']).show()
>>> 
+----------+-----+---+------------------+----------------------+
|CustomerID|Genre|Age|Annual Income (k$)|Spending Score (1-100)|
+----------+-----+---+------------------+----------------------+
|      0001|    M| 19|                15|                    39|
|      0002|    M| 21|                15|                    81|
|      0003|    F| 20|                16|                     6|
|      0004|    F| 23|                16|                    77|
|      0005|    F| 31|                17|                    40|
|      0006|    F| 22|                17|                    76|
|      0007|    F| 35|                18|                     6|
|      0008|    F| 23|                18|                    94|
|      0009|    M| 64|                19|                     3|
|      0010|    F| 30|                19|                    72|
|      0011|    M| 67|                19|                    14|
|      0012|    F| 35|                19|                    99|
|      0013|    F| 58|                20|                    15|
|      0014|    F| 24|                20|                    77|
|      0015|    M| 37|                20|                    13|
|      0016|    M| 22|                20|                    79|
|      0017|    F| 35|                21|                    35|
|      0018|    M| 20|                21|                    66|
|      0019|    M| 52|                23|                    29|
|      0020|    F| 35|                23|                    98|
+----------+-----+---+------------------+----------------------+
only showing top 20 rows
~~~
