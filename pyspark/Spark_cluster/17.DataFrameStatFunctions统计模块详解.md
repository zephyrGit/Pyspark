
1. DataFrameStatFunctions这个对象可以通过DataFrame的stat属性获取，在这个对象中有很多的用于统计DataFrame中数据的方法

~~~python
from pyspark.sql import SparkSession

spark = SparkSession.builder.master("local").appName('DFSF').getOrCreate()
df = spark.read.csv('./datas/titanic_train.csv', header=True)
df.stat
>>> <pyspark.sql.dataframe.DataFrameStatFunctions at 0x1bf86c925f8>
~~~

2. approxQuantile(col, probabilities, relativeError)这个方法用于计算指定列的分位数，col用于指定列名，probabilities用于指定分位数的值，介于0到1之间，如0表示最小值，0.5表示中位数，1表示最大值。relativeError用于指定相对误差，0表示精确计算，指定的列需要是数值类型

~~~python
df.select(df['Age'].astype('int')).stat.approxQuantile(
    'Age', [0., 0.25, 0.5, 0.75, 1.], 0.0001)
>>> [0.0, 20.0, 28.0, 38.0, 80.0]

df.select(df['Age'].astype('int')).stat.approxQuantile(
    'Age', [0., 0.25, 0.5, 0.75, 1.], 0.)
>>> [0.0, 20.0, 28.0, 38.0, 80.0]
~~~

3. corr(col1, col2, method=None) 用于计算两列的相关系数，同DataFrame上的corr方法例如计算年龄和票价的相关系数

~~~python
df.select(df['Age'].astype('int'),
          df['Fare'].cast('int')).stat.corr('Age', 'Fare')
>>> 0.13610476467863092
~~~

4. cov(col1, col2) 这个方法用于计算DataFrame中两列的协方差，类型需要是数值类型，同DataFrame上的cov方法

~~~python
df.select(df['Age'].astype('int'), df['Fare'].cast('int')).cov('Age', 'Fare')
>>> 119.04452515164128
df.select(df['Age'].astype('int'), df['Fare'].cast('int')).stat.cov('Age', 'Fare')
>>> 119.04452515164128
~~~

5. crosstab(col1, col2)计算两列数据组成的列联表

~~~python
df = spark.createDataFrame([('tom', 27), ('jerry', 25)],
                           schema=['name', 'age'])
df.stat.crosstab('age','name').show()
>>> 
+--------+-----+---+
|age_name|jerry|tom|
+--------+-----+---+
|      25|    1|  0|
|      27|    0|  1|
+--------+-----+---+
~~~

6. freqItems(cols, support=None)返回列上的频繁项集，同DataFrame上的freqItems方法，关键字参数support用于指定出现的频率所占的百分比，默认为1%

~~~python
df = spark.read.csv('./datas/titanic_train.csv', header=True)
df.freqItems(['Age', 'Fare']).show()
>>> 
+--------------------+--------------------+
|       Age_freqItems|      Fare_freqItems|
+--------------------+--------------------+
|[57, 28.5, 63, 0....|[73.5, 26.55, 9.5...|
+--------------------+--------------------+
                       
df.freqItems(['Age', 'Fare'], support=0.2).show()
>>> 
+-------------+------------------+
|Age_freqItems|    Fare_freqItems|
+-------------+------------------+
|[26, 32,, 19]|[7.8958, 30, 7.75]|
+-------------+------------------+

df.stat.freqItems(['Age', 'Fare'], support=0.2).show()
>>> 
+-------------+------------------+
|Age_freqItems|    Fare_freqItems|
+-------------+------------------+
|[26, 32,, 19]|[7.8958, 30, 7.75]|
+-------------+------------------+                       
~~~

7. sampleBy(col, fractions, seed=None)对于指定的列按fractions指定的抽样比例进行抽样，seed是随机因子，用于结果复现

~~~python
df.sampleBy('Sex', {'female': 0.3, 'male': 0.1}).show()
>>> 
+-----------+--------+------+--------------------+------+----+-----+-----+---------------+--------+-----+--------+
|PassengerId|Survived|Pclass|                Name|   Sex| Age|SibSp|Parch|         Ticket|    Fare|Cabin|Embarked|
+-----------+--------+------+--------------------+------+----+-----+-----+---------------+--------+-----+--------+
|         11|       1|     3|Sandstrom, Miss. ...|female|   4|    1|    1|        PP 9549|    16.7|   G6|       S|
|         16|       1|     2|Hewlett, Mrs. (Ma...|female|  55|    0|    0|         248706|      16| null|       S|
|         25|       0|     3|Palsson, Miss. To...|female|   8|    3|    1|         349909|  21.075| null|       S|
|         27|       0|     3|Emir, Mr. Farred ...|  male|null|    0|    0|           2631|   7.225| null|       C|
|         32|       1|     1|Spencer, Mrs. Wil...|female|null|    1|    0|       PC 17569|146.5208|  B78|       C|
|         33|       1|     3|Glynn, Miss. Mary...|female|null|    0|    0|         335677|    7.75| null|       Q|
|         36|       0|     1|Holverson, Mr. Al...|  male|  42|    1|    0|         113789|      52| null|       S|
|         40|       1|     3|Nicola-Yarred, Mi...|female|  14|    1|    0|           2651| 11.2417| null|       C|
|         45|       1|     3|Devaney, Miss. Ma...|female|  19|    0|    0|         330958|  7.8792| null|       Q|
|         52|       0|     3|Nosworthy, Mr. Ri...|  male|  21|    0|    0|     A/4. 39886|     7.8| null|       S|
|         60|       0|     3|Goodwin, Master. ...|  male|  11|    5|    2|        CA 2144|    46.9| null|       S|
|         62|       1|     1| Icard, Miss. Amelie|female|  38|    0|    0|         113572|      80|  B28|    null|
|         68|       0|     3|Crease, Mr. Ernes...|  male|  19|    0|    0|      S.P. 3464|  8.1583| null|       S|
|         69|       1|     3|Andersson, Miss. ...|female|  17|    4|    2|        3101281|   7.925| null|       S|
|         71|       0|     2|Jenkin, Mr. Steph...|  male|  32|    0|    0|     C.A. 33111|    10.5| null|       S|
|         74|       0|     3|Chronopoulos, Mr....|  male|  26|    1|    0|           2680| 14.4542| null|       C|
|         79|       1|     2|Caldwell, Master....|  male|0.83|    0|    2|         248738|      29| null|       S|
|         85|       1|     2| Ilett, Miss. Bertha|female|  17|    0|    0|     SO/C 14885|    10.5| null|       S|
|         88|       0|     3|Slocovski, Mr. Se...|  male|null|    0|    0|SOTON/OQ 392086|    8.05| null|       S|
|         96|       0|     3|Shorney, Mr. Char...|  male|null|    0|    0|         374910|    8.05| null|       S|
+-----------+--------+------+--------------------+------+----+-----+-----+---------------+--------+-----+--------+
only showing top 20 rows
~~~
查看抽样的记录数：
~~~python
df.sampleBy('Sex', {'female': 0.3, 'male': 0.1}).groupBy('Sex').count().show()
>>> 
+------+-----+
|   Sex|count|
+------+-----+
|female|   92|
|  male|   70|
+------+-----+

df.toPandas().groupby('Sex').size()
>>> 
Sex
female    314
male      577
dtype: int64
~~~
314 * 0.3 = 94.2
577 * 0.1 = 57
可以看出抽样的结果和实际按照数值计算的结果虽然有差异，但是还是基本接近的
